<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ktds.crmai.service.impl.BoardMapper">

	<select id="selectAllBoardList" resultType="board">
		SELECT 
			CODE AS "code", 
			TITLE AS "title",
			CONTENTS AS "contents",
			WRITER AS "writer",
			REG_DATETIME AS "reg_datetime"
		FROM  
			AI_BOARD
		ORDER BY 
			reg_datetime DESC
	</select>
	
	<select id="selectBoardList" resultType="board">
		SELECT
		    CODE AS "code",
			TITLE AS "title",
			CONTENTS AS "contents",
			WRITER AS "writer",
			REG_DATETIME AS "reg_datetime"
		FROM 
		    AI_BOARD
		<where>
			<if test="title != null and title != '' ">
				title like '%' || #{title} || '%'
			</if>
			
			<if test="writer != null and writer != '' ">
				AND type writer '%' || #{writer} || '%'
			</if>
			
			<if test="reg_datetime != null and reg_datetime != '' ">
				AND reg_datetime like '%' || #{reg_datetime} || '%'
			</if>
		</where>
		ORDER BY 
			reg_datetime DESC
    </select>
    
    <select id="selectBoardDetail" resultType="board">
		SELECT
		    CODE AS "code",
			TITLE AS "title",
			CONTENTS AS "contents",
			WRITER AS "writer",
			REG_DATETIME AS "reg_datetime"
		FROM 
		    AI_BOARD
		WHERE
			code =  #{code}
    </select>
    
    <insert id="insertBoard">
    	INSERT INTO AI_BOARD (CODE, TITLE, CONTENTS, WRITER, REG_DATETIME)
      	VALUES ((SELECT MAX(code + 1) FROM AI_BOARD), #{title}, #{contents}, #{writer}, now())
    </insert>
    
    	
	<update id="updateBoard">
		update AI_BOARD set title=#{title}, contents=#{contents} where code=#{code}
	</update>
    
    <delete id="deleteBoard">
    	DELETE FROM AI_BOARD 
    	WHERE 
    		code =  #{code}
    </delete>
    
    <select id="selectBoardPage" resultType="notice">
		select *
		from (
		select <![CDATA[ rownum as rnum ]]>
		, A.CODE, A.TITLE, A.CONTENTS, A.WRITER, A.REG_DATETIME
		from
		(
		select
			CODE,
			TITLE,
			CONTENTS,
			WRITER,
			REG_DATETIME
		from AI_BOARD
		order by REG_DATETIME desc
		) A
		where <![CDATA[ rownum <= #{page_end} ]]>
		) B
		where b.rnum >= #{page_st}
	</select>

	<select id="selectBoardPageNum" resultType="int">
		select count(*) as
		totalCount from AI_BOARD
	</select>
	
</mapper>	